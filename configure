#!/bin/sh

git checkout config.h
git checkout components/cpu.c

sed -i "2i #define N_CORES $(nproc --all)" components/cpu.c

for BAT in /sys/class/power_supply/BAT*
do
	sed -i "/BATSTATE/a { battery_state, \"%s]\", \"$BAT\"}," config.h
	sed -i "/BATSTATE/a { battery_perc, \"[%s\", \"$BAT\"}," config.h
done

ETH="$(ip link | grep enp | cut -d':' -f2 | xargs)"
if [ -n "$ETH" ]; then
	sed -i "/NETSPEED/a{ netspeed_tx, \"%7s]\", \"$ETH\"}," config.h
	sed -i "/NETSPEED/a{ netspeed_rx, \"[E%7s \", \"$ETH\"}," config.h
fi

WLAN="$(ip link | grep wlp | cut -d':' -f2 | xargs)"
if [ -n "$WLAN" ]; then
	sed -i "/NETSPEED/a{ netspeed_tx, \"%7s]\", \"$WLAN\"}," config.h
	sed -i "/NETSPEED/a{ netspeed_rx, \"%7s \", \"$WLAN\"}," config.h
	sed -i "/NETSPEED/a{ wifi_perc, \"[%3s\", \"$WLAN\"}," config.h
fi
